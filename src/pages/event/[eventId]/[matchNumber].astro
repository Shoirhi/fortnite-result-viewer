---
import StandingsSection from "@/components/standings/StandingsSection.astro";
import StandingsSlider from "@/components/standings/StandingsSlider.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import {
    createMatchStandingsSummary,
    ensureEventId,
    loadEvent,
    parseTournamentResults,
} from "@/lib/event-utils";

export const prerender = false;

const eventId = ensureEventId(Astro.params.eventId);
const event = await loadEvent(eventId);

Astro.response.headers.set(
    "Cache-Control",
    "no-store, no-cache, must-revalidate, proxy-revalidate",
);

const rawResults = parseTournamentResults(event.score, { eventId });
const summary = createMatchStandingsSummary(rawResults, Astro.params.matchNumber);
const { headingLabel, chunkedStandings, totalTeams } = summary;
---

<BaseLayout title={`${headingLabel} - ${event.title}`}>
    <StandingsSection headingLabel={headingLabel} totalTeams={totalTeams}>
        <StandingsSlider chunkedStandings={chunkedStandings} variant="match" />
    </StandingsSection>
</BaseLayout>
