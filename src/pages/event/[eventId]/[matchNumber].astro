---
import BaseLayout from "@/layouts/BaseLayout.astro";
import MatchStandingsClient from "@/components/standings/MatchStandingsClient";
import {
    createMatchStandingsSummary,
    ensureEventId,
    loadEvent,
    parseTournamentResults,
} from "@/lib/event-utils";

export const prerender = false;

const eventId = ensureEventId(Astro.params.eventId);
const event = await loadEvent(eventId);
const matchParam = Astro.params.matchNumber ?? "";

Astro.response.headers.set(
    "Cache-Control",
    "no-store, no-cache, must-revalidate, proxy-revalidate",
);

const rawResults = parseTournamentResults(event.score, { eventId });
const summary = createMatchStandingsSummary(rawResults, matchParam);
const { headingLabel } = summary;
const initialUpdatedAt = event.updatedAt ?? "";
---

<BaseLayout title={`${headingLabel} - ${event.title}`}>
    <MatchStandingsClient
        client:load
        eventId={eventId}
        eventTitle={event.title}
        matchParam={matchParam}
        initialSummary={summary}
        initialUpdatedAt={initialUpdatedAt}
    />
</BaseLayout>
