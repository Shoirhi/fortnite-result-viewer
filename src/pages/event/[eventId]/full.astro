---
import StandingsSection from "@/components/standings/StandingsSection.astro";
import StandingsTable from "@/components/standings/StandingsTable.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { ensureEventId, loadEvent } from "@/lib/event-utils";
import {
    createStandingsSummary,
    parseTournamentResults,
} from "@/lib/standings-summary";

export const prerender = false;

const eventId = ensureEventId(Astro.params.eventId);
const event = await loadEvent(eventId);

Astro.response.headers.set(
    "Cache-Control",
    "no-store, no-cache, must-revalidate, proxy-revalidate",
);

const rawResults = parseTournamentResults(event.score, { eventId });
const standings = createStandingsSummary(rawResults);
const { totalMatchesLabel, latestStandings, totalTeams } = standings;
---

<BaseLayout title={`${totalMatchesLabel} - ${event.title} (Full)`}>
    <StandingsSection headingLabel={totalMatchesLabel} totalTeams={totalTeams}>
        <StandingsTable entries={latestStandings} variant="event" />
    </StandingsSection>
</BaseLayout>
