---
import StandingsSection from "@/components/standings/StandingsSection.astro";
import StandingsSlider from "@/components/standings/StandingsSlider.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";
import {
    createStandingsSummary,
    ensureEventId,
    loadEvent,
    parseTournamentResults,
} from "@/lib/event-utils";

export const prerender = false;

const eventId = ensureEventId(Astro.params.eventId);
const event = await loadEvent(eventId);

Astro.response.headers.set("Cache-Control", "no-store, no-cache, must-revalidate, proxy-revalidate");

const rawResults = parseTournamentResults(event.score, { eventId });
const standings = createStandingsSummary(rawResults);
const { totalMatchesLabel, chunkedStandings, totalTeams } = standings;

---

<BaseLayout title={`${totalMatchesLabel} - ${event.title}`}>
    <StandingsSection headingLabel={totalMatchesLabel} totalTeams={totalTeams}>
        <StandingsSlider chunkedStandings={chunkedStandings} variant="event" />
    </StandingsSection>
</BaseLayout>
